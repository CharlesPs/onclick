{"ast":null,"code":"import FuseUtils from '@fuse/utils';\nimport history from '@history';\nimport firebaseService from 'app/services/firebaseService';\nimport _ from '@lodash';\nimport { showMessage } from 'app/store/actions/fuse';\nimport axios from 'axios';\nimport CardModel from '../../model/CardModel';\nimport ListModel from '../../model/ListModel';\nimport * as BoardsActions from './boards.actions';\nimport reorder, { reorderQuoteMap } from './reorder';\nexport var GET_BOARD = '[SCRUMBOARD APP] GET BOARD';\nexport var DELETE_BOARD = '[SCRUMBOARD APP] DELETE BOARD';\nexport var COPY_BOARD = '[SCRUMBOARD APP] COPY BOARD';\nexport var RENAME_BOARD = '[SCRUMBOARD APP] RENAME BOARD';\nexport var CHANGE_BOARD_SETTINGS = '[SCRUMBOARD APP] CHANGE BOARD SETTINGS';\nexport var RESET_BOARD = '[SCRUMBOARD APP] RESET BOARD';\nexport var ORDER_LIST = '[SCRUMBOARD APP] ORDER LIST';\nexport var ORDER_CARD = '[SCRUMBOARD APP] ORDER CARD';\nexport var ADD_CARD = '[SCRUMBOARD APP] ADD CARD';\nexport var ADD_LIST = '[SCRUMBOARD APP] ADD LIST';\nexport var ADD_LABEL = '[SCRUMBOARD APP] ADD LABEL';\nexport var RENAME_LIST = '[SCRUMBOARD APP] RENAME LIST';\nexport var REMOVE_LIST = '[SCRUMBOARD APP] REMOVE LIST';\nexport function getBoard(params) {\n  console.log('getBoard');\n  var ref = firebaseService.db.ref('board/' + params.boardId);\n  return function (dispatch) {\n    return ref.once('value').then(function (snapshot) {\n      var board = snapshot.val();\n      board.id = params.boardId;\n      return dispatch({\n        type: GET_BOARD,\n        payload: board\n      });\n    });\n  };\n}\nexport function resetBoard() {\n  return {\n    type: RESET_BOARD\n  };\n}\nexport function reorderList(result) {\n  return function (dispatch, getState) {\n    var board = getState().scrumboardApp.board;\n    var lists = board.lists;\n    var ordered = board.lists;\n    console.log(board);\n    console.log(ordered);\n    firebaseService.db.ref(\"board/\".concat(board.id, \"/lists\")).remove().then(function () {\n      var promises = [];\n      ordered.map(function (item) {\n        promises.push(firebaseService.db.ref('board/' + boardId + '/lists').push(data));\n      });\n      return Promise.all(promises).then(function (result) {\n        Promise.all([dispatch({\n          type: ORDER_LIST,\n          payload: ordered\n        })]).then(function () {\n          return dispatch(getBoard({\n            boardId: board.id\n          }));\n        });\n      });\n    }); // const request = axios.post('/api/scrumboard-app/list/order', {\n    //     boardId: board.id,\n    //     lists: ordered\n    // });\n    // request.then(response => {\n    //     dispatch(\n    //         showMessage({\n    //             message: 'List Order Saved',\n    //             autoHideDuration: 2000,\n    //             anchorOrigin: {\n    //                 vertical: 'top',\n    //                 horizontal: 'right'\n    //             }\n    //         })\n    //     );\n    // });\n    // return dispatch({\n    //     type: ORDER_LIST,\n    //     payload: ordered\n    // });\n  };\n}\nexport function reorderCard(result) {\n  return function (dispatch, getState) {\n    var board = getState().scrumboardApp.board;\n    var lists = board.lists;\n    var ordered = reorderQuoteMap(lists, result.source, result.destination);\n    firebaseService.db.ref(\"board/\".concat(board.id, \"/lists\")).remove().then(function () {// Promise.all([\n      //     dispatch({\n      //         type: REMOVE_LIST\n      //     })\n      // ]).then(() => dispatch(getBoard({ boardId: boardId })));\n    });\n    console.log(board);\n    console.log(ordered); // const request = axios.post('/api/scrumboard-app/card/order', {\n    //     boardId: board.id,\n    //     lists: ordered\n    // });\n    // request.then(response => {\n    //     dispatch(\n    //         showMessage({\n    //             message: 'Card Order Saved',\n    //             autoHideDuration: 2000,\n    //             anchorOrigin: {\n    //                 vertical: 'top',\n    //                 horizontal: 'right'\n    //             }\n    //         })\n    //     );\n    // });\n    // return dispatch({\n    //     type: ORDER_CARD,\n    //     payload: ordered\n    // });\n  };\n}\nexport function newCard(boardId, listId, cardTitle) {\n  var data = new CardModel({\n    name: cardTitle\n  });\n  var request = axios.post('/api/scrumboard-app/card/new', {\n    boardId: boardId,\n    listId: listId,\n    data: data\n  });\n  return function (dispatch) {\n    return new Promise(function (resolve, reject) {\n      request.then(function (response) {\n        resolve(response.data);\n        return dispatch({\n          type: ADD_CARD,\n          payload: response.data\n        });\n      });\n    });\n  };\n}\nexport function newList(boardId, listTitle) {\n  var data = new ListModel({\n    name: listTitle\n  });\n  return function (dispatch) {\n    return firebaseService.db.ref('board/' + boardId + '/lists').push(data).then(function (snapshot) {\n      dispatch(getBoard({\n        boardId: boardId\n      }));\n    });\n  };\n}\nexport function renameList(boardId, listId, listTitle) {\n  return function (dispatch, getState) {\n    firebaseService.db.ref(\"board/\".concat(boardId, \"/lists/\").concat(listId)).update({\n      name: listTitle\n    }).then(function () {\n      Promise.all([dispatch({\n        type: RENAME_LIST,\n        listId: listId,\n        listTitle: listTitle\n      })]).then(function () {\n        return dispatch(getBoard({\n          boardId: boardId\n        }));\n      });\n    }).catch(function (error) {\n      return {\n        errorCode: error.code,\n        errorMessage: error.message\n      };\n    });\n  };\n}\nexport function removeList(boardId, listId) {\n  return function (dispatch) {\n    return firebaseService.db.ref(\"board/\".concat(boardId, \"/lists/\").concat(listId)).remove().then(function () {\n      Promise.all([dispatch({\n        type: REMOVE_LIST\n      })]).then(function () {\n        return dispatch(getBoard({\n          boardId: boardId\n        }));\n      });\n    }).catch(function (error) {\n      return {\n        errorCode: error.code,\n        errorMessage: error.message\n      };\n    });\n  };\n}\nexport function addLabel(label) {\n  return function (dispatch) {\n    return dispatch({\n      type: ADD_LABEL,\n      payload: label\n    });\n  };\n}\nexport function changeBoardSettings(newSettings) {\n  return function (dispatch, getState) {\n    var board = getState().scrumboardApp.board;\n\n    var settings = _.merge(board.settings, newSettings);\n\n    var request = axios.post('/api/scrumboard-app/board/settings/update', {\n      boardId: board.id,\n      settings: settings\n    });\n    return request.then(function (response) {\n      return dispatch({\n        type: CHANGE_BOARD_SETTINGS,\n        payload: response.data\n      });\n    });\n  };\n}\nexport function deleteBoard(boardId) {\n  var request = axios.post('/api/scrumboard-app/board/delete', {\n    boardId: boardId\n  });\n  return function (dispatch) {\n    return request.then(function (response) {\n      history.push({\n        pathname: '/apps/scrumboard/boards'\n      });\n      return dispatch({\n        type: DELETE_BOARD\n      });\n    });\n  };\n}\nexport function copyBoard(board) {\n  var newBoard = _.merge(board, {\n    id: FuseUtils.generateGUID(),\n    name: \"\".concat(board.name, \" (Copied)\"),\n    uri: \"\".concat(board.uri, \"-copied\")\n  });\n\n  return function (dispatch) {\n    dispatch(BoardsActions.newBoard(newBoard));\n    return {\n      type: COPY_BOARD\n    };\n  };\n}\nexport function renameBoard(boardId, boardTitle) {\n  return function (dispatch, getState) {\n    firebaseService.db.ref(\"board/\".concat(boardId)).update({\n      name: boardTitle\n    }).then(function () {\n      Promise.all([dispatch({\n        type: RENAME_BOARD,\n        boardTitle: boardTitle\n      })]).then(function () {\n        return dispatch(getBoard({\n          boardId: boardId\n        }));\n      });\n    }).catch(function (error) {\n      return {\n        errorCode: error.code,\n        errorMessage: error.message\n      };\n    });\n  };\n}","map":{"version":3,"sources":["/Users/msumaran/Documents/Proyectos/masternativos/src/app/scrumboard/store/actions/board.actions.js"],"names":["FuseUtils","history","firebaseService","_","showMessage","axios","CardModel","ListModel","BoardsActions","reorder","reorderQuoteMap","GET_BOARD","DELETE_BOARD","COPY_BOARD","RENAME_BOARD","CHANGE_BOARD_SETTINGS","RESET_BOARD","ORDER_LIST","ORDER_CARD","ADD_CARD","ADD_LIST","ADD_LABEL","RENAME_LIST","REMOVE_LIST","getBoard","params","console","log","ref","db","boardId","dispatch","once","then","snapshot","board","val","id","type","payload","resetBoard","reorderList","result","getState","scrumboardApp","lists","ordered","remove","promises","map","item","push","data","Promise","all","reorderCard","source","destination","newCard","listId","cardTitle","name","request","post","resolve","reject","response","newList","listTitle","renameList","update","catch","error","errorCode","code","errorMessage","message","removeList","addLabel","label","changeBoardSettings","newSettings","settings","merge","deleteBoard","pathname","copyBoard","newBoard","generateGUID","uri","renameBoard","boardTitle"],"mappings":"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","sourcesContent":["import FuseUtils from '@fuse/utils';\nimport history from '@history';\nimport firebaseService from 'app/services/firebaseService';\nimport _ from '@lodash';\nimport { showMessage } from 'app/store/actions/fuse';\nimport axios from 'axios';\nimport CardModel from '../../model/CardModel';\nimport ListModel from '../../model/ListModel';\nimport * as BoardsActions from './boards.actions';\nimport reorder, { reorderQuoteMap } from './reorder';\n\n\nexport const GET_BOARD = '[SCRUMBOARD APP] GET BOARD';\nexport const DELETE_BOARD = '[SCRUMBOARD APP] DELETE BOARD';\nexport const COPY_BOARD = '[SCRUMBOARD APP] COPY BOARD';\nexport const RENAME_BOARD = '[SCRUMBOARD APP] RENAME BOARD';\nexport const CHANGE_BOARD_SETTINGS = '[SCRUMBOARD APP] CHANGE BOARD SETTINGS';\nexport const RESET_BOARD = '[SCRUMBOARD APP] RESET BOARD';\nexport const ORDER_LIST = '[SCRUMBOARD APP] ORDER LIST';\nexport const ORDER_CARD = '[SCRUMBOARD APP] ORDER CARD';\nexport const ADD_CARD = '[SCRUMBOARD APP] ADD CARD';\nexport const ADD_LIST = '[SCRUMBOARD APP] ADD LIST';\nexport const ADD_LABEL = '[SCRUMBOARD APP] ADD LABEL';\nexport const RENAME_LIST = '[SCRUMBOARD APP] RENAME LIST';\nexport const REMOVE_LIST = '[SCRUMBOARD APP] REMOVE LIST';\n\nexport function getBoard(params) {\n    console.log('getBoard');\n    let ref = firebaseService.db.ref('board/' + params.boardId);\n    return dispatch =>\n        ref\n        .once('value')\n        .then(snapshot => {\n            let board = snapshot.val();\n            board.id = params.boardId;\n            return dispatch({\n                type: GET_BOARD,\n                payload: board\n            })\n\n        });\n\n}\n\nexport function resetBoard() {\n    return {\n        type: RESET_BOARD\n    };\n}\n\nexport function reorderList(result) {\n    return (dispatch, getState) => {\n        const { board } = getState().scrumboardApp;\n        const { lists } = board;\n\n        const ordered = board.lists;\n        console.log(board);\n        console.log(ordered);\n\n\n        firebaseService.db.ref(`board/${board.id}/lists`).remove().then(() => {\n            let promises = [];\n            ordered.map((item) => {\n                promises.push(firebaseService.db.ref('board/' + boardId + '/lists').push(data));\n            });\n\n            return Promise.all(promises).then(result => {\n                Promise.all([\n                    dispatch({\n                        type: ORDER_LIST,\n                        payload: ordered\n                    })\n                ]).then(() => dispatch(getBoard({ boardId: board.id })));\n            });\n\n        });\n        // const request = axios.post('/api/scrumboard-app/list/order', {\n        //     boardId: board.id,\n        //     lists: ordered\n        // });\n\n        // request.then(response => {\n        //     dispatch(\n        //         showMessage({\n        //             message: 'List Order Saved',\n        //             autoHideDuration: 2000,\n        //             anchorOrigin: {\n        //                 vertical: 'top',\n        //                 horizontal: 'right'\n        //             }\n        //         })\n        //     );\n        // });\n\n        // return dispatch({\n        //     type: ORDER_LIST,\n        //     payload: ordered\n        // });\n    };\n}\n\nexport function reorderCard(result) {\n    return (dispatch, getState) => {\n        const { board } = getState().scrumboardApp;\n        const { lists } = board;\n\n        const ordered = reorderQuoteMap(lists, result.source, result.destination);\n\n\n        firebaseService.db.ref(`board/${board.id}/lists`).remove().then(() => {\n\n\n\n\n\n            // Promise.all([\n            //     dispatch({\n            //         type: REMOVE_LIST\n            //     })\n            // ]).then(() => dispatch(getBoard({ boardId: boardId })));\n        })\n\n\n\n        console.log(board);\n        console.log(ordered);\n        // const request = axios.post('/api/scrumboard-app/card/order', {\n        //     boardId: board.id,\n        //     lists: ordered\n        // });\n\n        // request.then(response => {\n        //     dispatch(\n        //         showMessage({\n        //             message: 'Card Order Saved',\n        //             autoHideDuration: 2000,\n        //             anchorOrigin: {\n        //                 vertical: 'top',\n        //                 horizontal: 'right'\n        //             }\n        //         })\n        //     );\n        // });\n\n        // return dispatch({\n        //     type: ORDER_CARD,\n        //     payload: ordered\n        // });\n    };\n}\n\nexport function newCard(boardId, listId, cardTitle) {\n    const data = new CardModel({ name: cardTitle });\n\n    const request = axios.post('/api/scrumboard-app/card/new', {\n        boardId,\n        listId,\n        data\n    });\n    return dispatch =>\n        new Promise((resolve, reject) => {\n            request.then(response => {\n                resolve(response.data);\n                return dispatch({\n                    type: ADD_CARD,\n                    payload: response.data\n                });\n            });\n        });\n}\n\nexport function newList(boardId, listTitle) {\n    const data = new ListModel({ name: listTitle });\n    return dispatch =>\n        firebaseService.db.ref('board/' + boardId + '/lists').push(data).then((snapshot) => {\n            dispatch(getBoard({ boardId: boardId }));\n        });\n\n}\n\nexport function renameList(boardId, listId, listTitle) {\n\n    return (dispatch, getState) => {\n        firebaseService.db.ref(`board/${boardId}/lists/${listId}`).update({ name: listTitle }).then(() => {\n            Promise.all([\n                dispatch({\n                    type: RENAME_LIST,\n                    listId,\n                    listTitle\n                })\n            ]).then(() => dispatch(getBoard({ boardId: boardId })));\n        }).catch(error => {\n            return {\n                errorCode: error.code,\n                errorMessage: error.message\n            }\n        });\n    };\n}\n\nexport function removeList(boardId, listId) {\n\n    return dispatch =>\n        firebaseService.db.ref(`board/${boardId}/lists/${listId}`).remove().then(() => {\n            Promise.all([\n                dispatch({\n                    type: REMOVE_LIST\n                })\n            ]).then(() => dispatch(getBoard({ boardId: boardId })));\n        }).catch(error => {\n            return {\n                errorCode: error.code,\n                errorMessage: error.message\n            }\n        });\n}\n\nexport function addLabel(label) {\n    return dispatch => {\n        return dispatch({\n            type: ADD_LABEL,\n            payload: label\n        });\n    };\n}\n\nexport function changeBoardSettings(newSettings) {\n    return (dispatch, getState) => {\n        const { board } = getState().scrumboardApp;\n        const settings = _.merge(board.settings, newSettings);\n        const request = axios.post('/api/scrumboard-app/board/settings/update', {\n            boardId: board.id,\n            settings\n        });\n\n        return request.then(response =>\n            dispatch({\n                type: CHANGE_BOARD_SETTINGS,\n                payload: response.data\n            })\n        );\n    };\n}\n\nexport function deleteBoard(boardId) {\n    const request = axios.post('/api/scrumboard-app/board/delete', {\n        boardId\n    });\n\n    return dispatch =>\n        request.then(response => {\n            history.push({\n                pathname: '/apps/scrumboard/boards'\n            });\n\n            return dispatch({\n                type: DELETE_BOARD\n            });\n        });\n}\n\nexport function copyBoard(board) {\n    const newBoard = _.merge(board, {\n        id: FuseUtils.generateGUID(),\n        name: `${board.name} (Copied)`,\n        uri: `${board.uri}-copied`\n    });\n    return dispatch => {\n        dispatch(BoardsActions.newBoard(newBoard));\n        return { type: COPY_BOARD };\n    };\n}\n\nexport function renameBoard(boardId, boardTitle) {\n    return (dispatch, getState) => {\n        firebaseService.db.ref(`board/${boardId}`).update({ name: boardTitle }).then(() => {\n            Promise.all([\n                dispatch({\n                    type: RENAME_BOARD,\n                    boardTitle\n                })\n            ]).then(() => dispatch(getBoard({ boardId: boardId })));\n        }).catch(error => {\n            return {\n                errorCode: error.code,\n                errorMessage: error.message\n            }\n        });\n    };\n\n\n}"]},"metadata":{},"sourceType":"module"}