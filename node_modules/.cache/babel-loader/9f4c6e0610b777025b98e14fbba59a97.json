{"ast":null,"code":"import FuseUtils from '@fuse/utils';\nimport history from '@history';\nimport firebaseService from 'app/services/firebaseService';\nimport _ from '@lodash';\nimport { showMessage } from 'app/store/actions/fuse';\nimport CardModel from '../../model/CardModel';\nimport ListModel from '../../model/ListModel';\nimport * as BoardsActions from './boards.actions';\nimport reorder from './reorder';\nimport { unset } from 'lodash';\nexport var GET_BOARD = '[SCRUMBOARD APP] GET BOARD';\nexport var DELETE_BOARD = '[SCRUMBOARD APP] DELETE BOARD';\nexport var COPY_BOARD = '[SCRUMBOARD APP] COPY BOARD';\nexport var RENAME_BOARD = '[SCRUMBOARD APP] RENAME BOARD';\nexport var CHANGE_BOARD_SETTINGS = '[SCRUMBOARD APP] CHANGE BOARD SETTINGS';\nexport var RESET_BOARD = '[SCRUMBOARD APP] RESET BOARD';\nexport var ORDER_LIST = '[SCRUMBOARD APP] ORDER LIST';\nexport var ORDER_CARD = '[SCRUMBOARD APP] ORDER CARD';\nexport var ADD_CARD = '[SCRUMBOARD APP] ADD CARD';\nexport var ADD_LIST = '[SCRUMBOARD APP] ADD LIST';\nexport var ADD_LABEL = '[SCRUMBOARD APP] ADD LABEL';\nexport var RENAME_LIST = '[SCRUMBOARD APP] RENAME LIST';\nexport var REMOVE_LIST = '[SCRUMBOARD APP] REMOVE LIST';\nexport function getBoard(params) {\n  var ref = firebaseService.db.ref('board/' + params.boardId);\n  return function (dispatch) {\n    return ref.once('value').then(function (snapshot) {\n      var board = snapshot.val();\n      if (board == null) return;\n      board.id = params.boardId;\n      return dispatch({\n        type: GET_BOARD,\n        payload: board\n      });\n    });\n  };\n}\nexport function resetBoard() {\n  return {\n    type: RESET_BOARD\n  };\n}\nexport function reorderList(result) {\n  return function (dispatch, getState) {\n    var board = getState().scrumboardApp.board;\n    var lists = board.lists;\n    var ordered = reorder(lists, result.source.index, result.destination.index);\n    firebaseService.db.ref(\"board/\".concat(board.id, \"/lists\")).remove().then(function () {\n      var promises = [];\n      ordered.forEach(function (element) {\n        unset(element.id);\n        promises.push(firebaseService.db.ref(\"board/\".concat(board.id, \"/lists\")).push(element));\n      });\n      return Promise.all(promises).then(function (result) {\n        dispatch(showMessage({\n          message: 'List Order Saved',\n          autoHideDuration: 2000,\n          anchorOrigin: {\n            vertical: 'top',\n            horizontal: 'right'\n          }\n        }));\n      });\n    });\n    dispatch(getBoard({\n      boardId: board.id\n    }));\n    return dispatch({\n      type: ORDER_LIST,\n      payload: ordered\n    });\n  };\n}\nexport function reorderCard(result) {\n  return function (dispatch, getState) {\n    var board = getState().scrumboardApp.board; //const ordered = reorderQuoteMap(lists, result.source, result.destination);\n\n    board.lists.map(function (list) {\n      list.cards = _.keyBy(list.cards, 'id');\n      list.cards = _.toArray(list.cards);\n      return null;\n    });\n    board.lists = _.toArray(board.lists);\n    board.lists = _.keyBy(board.lists, 'id');\n    console.log(lists);\n    firebaseService.db.ref(\"board/\".concat(board.id)).update(board).then(function () {\n      return dispatch(getBoard({\n        boardId: board.id\n      }));\n    });\n  };\n}\nexport function newCard(boardId, listId, cardTitle) {\n  var data = new CardModel({\n    name: cardTitle\n  });\n  return function (dispatch) {\n    return firebaseService.db.ref(\"board/\".concat(boardId, \"/lists/\").concat(listId, \"/cards\")).push(data).then(function (snapshot) {\n      dispatch(getBoard({\n        boardId: boardId\n      }));\n    });\n  };\n}\nexport function newList(boardId, listTitle) {\n  var data = new ListModel({\n    name: listTitle\n  });\n  return function (dispatch) {\n    return firebaseService.db.ref('board/' + boardId + '/lists').push(data).then(function (snapshot) {\n      dispatch(getBoard({\n        boardId: boardId\n      }));\n    });\n  };\n}\nexport function renameList(boardId, listId, listTitle) {\n  return function (dispatch, getState) {\n    firebaseService.db.ref(\"board/\".concat(boardId, \"/lists/\").concat(listId)).update({\n      name: listTitle\n    }).then(function () {\n      Promise.all([dispatch({\n        type: RENAME_LIST,\n        listId: listId,\n        listTitle: listTitle\n      })]).then(function () {\n        return dispatch(getBoard({\n          boardId: boardId\n        }));\n      });\n    }).catch(function (error) {\n      return {\n        errorCode: error.code,\n        errorMessage: error.message\n      };\n    });\n  };\n}\nexport function removeList(boardId, listId) {\n  return function (dispatch) {\n    return firebaseService.db.ref(\"board/\".concat(boardId, \"/lists/\").concat(listId)).remove().then(function () {\n      Promise.all([dispatch({\n        type: REMOVE_LIST\n      })]).then(function () {\n        return dispatch(getBoard({\n          boardId: boardId\n        }));\n      });\n    }).catch(function (error) {\n      return {\n        errorCode: error.code,\n        errorMessage: error.message\n      };\n    });\n  };\n}\nexport function addLabel(label) {\n  return function (dispatch) {\n    return dispatch({\n      type: ADD_LABEL,\n      payload: label\n    });\n  };\n}\nexport function changeBoardSettings(newSettings) {\n  return function (dispatch, getState) {\n    var board = getState().scrumboardApp.board;\n\n    var settings = _.merge(board.settings, newSettings);\n\n    firebaseService.db.ref(\"board/\".concat(board.id, \"/settings\")).update(settings).then(function (response) {\n      Promise.all([dispatch({\n        type: CHANGE_BOARD_SETTINGS,\n        payload: settings\n      })]).then(function () {\n        return dispatch(getBoard({\n          boardId: board.id\n        }));\n      });\n    });\n  };\n}\nexport function deleteBoard(boardId) {\n  return function (dispatch, getState) {\n    firebaseService.db.ref(\"board/\".concat(boardId)).remove().then(function () {\n      history.push({\n        pathname: '/scrumboard/boards'\n      });\n      return dispatch({\n        type: DELETE_BOARD\n      });\n    });\n  };\n}\nexport function copyBoard(board) {\n  var newBoard = _.merge(board, {\n    id: FuseUtils.generateGUID(),\n    name: \"\".concat(board.name, \" (Copied)\"),\n    uri: \"\".concat(board.uri, \"-copied\")\n  });\n\n  return function (dispatch) {\n    dispatch(BoardsActions.newBoard(newBoard));\n    return {\n      type: COPY_BOARD\n    };\n  };\n}\nexport function renameBoard(boardId, boardTitle) {\n  return function (dispatch, getState) {\n    firebaseService.db.ref(\"board/\".concat(boardId)).update({\n      name: boardTitle\n    }).then(function () {\n      Promise.all([dispatch({\n        type: RENAME_BOARD,\n        boardTitle: boardTitle\n      })]).then(function () {\n        return dispatch(getBoard({\n          boardId: boardId\n        }));\n      });\n    }).catch(function (error) {\n      return {\n        errorCode: error.code,\n        errorMessage: error.message\n      };\n    });\n  };\n}","map":{"version":3,"sources":["/Users/msumaran/Documents/Proyectos/masternativos/src/app/scrumboard/store/actions/board.actions.js"],"names":["FuseUtils","history","firebaseService","_","showMessage","CardModel","ListModel","BoardsActions","reorder","unset","GET_BOARD","DELETE_BOARD","COPY_BOARD","RENAME_BOARD","CHANGE_BOARD_SETTINGS","RESET_BOARD","ORDER_LIST","ORDER_CARD","ADD_CARD","ADD_LIST","ADD_LABEL","RENAME_LIST","REMOVE_LIST","getBoard","params","ref","db","boardId","dispatch","once","then","snapshot","board","val","id","type","payload","resetBoard","reorderList","result","getState","scrumboardApp","lists","ordered","source","index","destination","remove","promises","forEach","element","push","Promise","all","message","autoHideDuration","anchorOrigin","vertical","horizontal","reorderCard","map","list","cards","keyBy","toArray","console","log","update","newCard","listId","cardTitle","data","name","newList","listTitle","renameList","catch","error","errorCode","code","errorMessage","removeList","addLabel","label","changeBoardSettings","newSettings","settings","merge","response","deleteBoard","pathname","copyBoard","newBoard","generateGUID","uri","renameBoard","boardTitle"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,aAAtB;AACA,OAAOC,OAAP,MAAoB,UAApB;AACA,OAAOC,eAAP,MAA4B,8BAA5B;AACA,OAAOC,CAAP,MAAc,SAAd;AACA,SAASC,WAAT,QAA4B,wBAA5B;AACA,OAAOC,SAAP,MAAsB,uBAAtB;AACA,OAAOC,SAAP,MAAsB,uBAAtB;AACA,OAAO,KAAKC,aAAZ,MAA+B,kBAA/B;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,SAASC,KAAT,QAAsB,QAAtB;AAGA,OAAO,IAAMC,SAAS,GAAG,4BAAlB;AACP,OAAO,IAAMC,YAAY,GAAG,+BAArB;AACP,OAAO,IAAMC,UAAU,GAAG,6BAAnB;AACP,OAAO,IAAMC,YAAY,GAAG,+BAArB;AACP,OAAO,IAAMC,qBAAqB,GAAG,wCAA9B;AACP,OAAO,IAAMC,WAAW,GAAG,8BAApB;AACP,OAAO,IAAMC,UAAU,GAAG,6BAAnB;AACP,OAAO,IAAMC,UAAU,GAAG,6BAAnB;AACP,OAAO,IAAMC,QAAQ,GAAG,2BAAjB;AACP,OAAO,IAAMC,QAAQ,GAAG,2BAAjB;AACP,OAAO,IAAMC,SAAS,GAAG,4BAAlB;AACP,OAAO,IAAMC,WAAW,GAAG,8BAApB;AACP,OAAO,IAAMC,WAAW,GAAG,8BAApB;AAEP,OAAO,SAASC,QAAT,CAAkBC,MAAlB,EAA0B;AAE7B,MAAIC,GAAG,GAAGvB,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,CAAuB,WAAWD,MAAM,CAACG,OAAzC,CAAV;AACA,SAAO,UAAAC,QAAQ;AAAA,WACXH,GAAG,CACEI,IADL,CACU,OADV,EAEKC,IAFL,CAEU,UAAAC,QAAQ,EAAI;AAEd,UAAIC,KAAK,GAAGD,QAAQ,CAACE,GAAT,EAAZ;AACA,UAAID,KAAK,IAAI,IAAb,EAAmB;AACnBA,MAAAA,KAAK,CAACE,EAAN,GAAWV,MAAM,CAACG,OAAlB;AACA,aAAOC,QAAQ,CAAC;AACZO,QAAAA,IAAI,EAAEzB,SADM;AAEZ0B,QAAAA,OAAO,EAAEJ;AAFG,OAAD,CAAf;AAKH,KAZL,CADW;AAAA,GAAf;AAeH;AAED,OAAO,SAASK,UAAT,GAAsB;AACzB,SAAO;AACHF,IAAAA,IAAI,EAAEpB;AADH,GAAP;AAGH;AAED,OAAO,SAASuB,WAAT,CAAqBC,MAArB,EAA6B;AAChC,SAAO,UAACX,QAAD,EAAWY,QAAX,EAAwB;AAAA,QACnBR,KADmB,GACTQ,QAAQ,GAAGC,aADF,CACnBT,KADmB;AAAA,QAEnBU,KAFmB,GAETV,KAFS,CAEnBU,KAFmB;AAK3B,QAAIC,OAAO,GAAGnC,OAAO,CAACkC,KAAD,EAAQH,MAAM,CAACK,MAAP,CAAcC,KAAtB,EAA6BN,MAAM,CAACO,WAAP,CAAmBD,KAAhD,CAArB;AAEA3C,IAAAA,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCO,KAAK,CAACE,EAAtC,aAAkDa,MAAlD,GAA2DjB,IAA3D,CAAgE,YAAM;AAClE,UAAIkB,QAAQ,GAAG,EAAf;AACAL,MAAAA,OAAO,CAACM,OAAR,CAAgB,UAAAC,OAAO,EAAI;AACvBzC,QAAAA,KAAK,CAACyC,OAAO,CAAChB,EAAT,CAAL;AACAc,QAAAA,QAAQ,CAACG,IAAT,CAAejD,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCO,KAAK,CAACE,EAAtC,aAAkDiB,IAAlD,CAAuDD,OAAvD,CAAf;AACH,OAHD;AAKA,aAAOE,OAAO,CAACC,GAAR,CAAYL,QAAZ,EAAsBlB,IAAtB,CAA2B,UAAAS,MAAM,EAAI;AACxCX,QAAAA,QAAQ,CACJxB,WAAW,CAAC;AACRkD,UAAAA,OAAO,EAAE,kBADD;AAERC,UAAAA,gBAAgB,EAAE,IAFV;AAGRC,UAAAA,YAAY,EAAE;AACVC,YAAAA,QAAQ,EAAE,KADA;AAEVC,YAAAA,UAAU,EAAE;AAFF;AAHN,SAAD,CADP,CAAR;AAUH,OAXM,CAAP;AAYH,KAnBD;AAoBA9B,IAAAA,QAAQ,CAACL,QAAQ,CAAC;AAAEI,MAAAA,OAAO,EAAEK,KAAK,CAACE;AAAjB,KAAD,CAAT,CAAR;AACA,WAAON,QAAQ,CAAC;AACrBO,MAAAA,IAAI,EAAEnB,UADe;AAErBoB,MAAAA,OAAO,EAAEO;AAFY,KAAD,CAAf;AAIH,GAhCD;AAiCH;AAED,OAAO,SAASgB,WAAT,CAAqBpB,MAArB,EAA6B;AAChC,SAAO,UAACX,QAAD,EAAWY,QAAX,EAAwB;AAAA,QACnBR,KADmB,GACTQ,QAAQ,GAAGC,aADF,CACnBT,KADmB,EAG3B;;AACAA,IAAAA,KAAK,CAACU,KAAN,CAAYkB,GAAZ,CAAgB,UAAAC,IAAI,EAAI;AACpBA,MAAAA,IAAI,CAACC,KAAL,GAAa3D,CAAC,CAAC4D,KAAF,CAAQF,IAAI,CAACC,KAAb,EAAoB,IAApB,CAAb;AACAD,MAAAA,IAAI,CAACC,KAAL,GAAa3D,CAAC,CAAC6D,OAAF,CAAUH,IAAI,CAACC,KAAf,CAAb;AACA,aAAO,IAAP;AACH,KAJD;AAKA9B,IAAAA,KAAK,CAACU,KAAN,GAAcvC,CAAC,CAAC6D,OAAF,CAAUhC,KAAK,CAACU,KAAhB,CAAd;AACAV,IAAAA,KAAK,CAACU,KAAN,GAAcvC,CAAC,CAAC4D,KAAF,CAAQ/B,KAAK,CAACU,KAAd,EAAqB,IAArB,CAAd;AAEAuB,IAAAA,OAAO,CAACC,GAAR,CAAYxB,KAAZ;AACAxC,IAAAA,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCO,KAAK,CAACE,EAAtC,GAA4CiC,MAA5C,CAAmDnC,KAAnD,EAA0DF,IAA1D,CAA+D,YAAM;AACjE,aAAOF,QAAQ,CAACL,QAAQ,CAAC;AAAEI,QAAAA,OAAO,EAAEK,KAAK,CAACE;AAAjB,OAAD,CAAT,CAAf;AACH,KAFD;AAIH,GAjBD;AAkBH;AACD,OAAO,SAASkC,OAAT,CAAiBzC,OAAjB,EAA0B0C,MAA1B,EAAkCC,SAAlC,EAA6C;AAChD,MAAMC,IAAI,GAAG,IAAIlE,SAAJ,CAAc;AAAEmE,IAAAA,IAAI,EAAEF;AAAR,GAAd,CAAb;AAGA,SAAO,UAAA1C,QAAQ;AAAA,WACX1B,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCE,OAAhC,oBAAiD0C,MAAjD,aAAiElB,IAAjE,CAAsEoB,IAAtE,EAA4EzC,IAA5E,CAAiF,UAACC,QAAD,EAAc;AAC3FH,MAAAA,QAAQ,CAACL,QAAQ,CAAC;AAAEI,QAAAA,OAAO,EAAEA;AAAX,OAAD,CAAT,CAAR;AACH,KAFD,CADW;AAAA,GAAf;AAIH;AAED,OAAO,SAAS8C,OAAT,CAAiB9C,OAAjB,EAA0B+C,SAA1B,EAAqC;AACxC,MAAMH,IAAI,GAAG,IAAIjE,SAAJ,CAAc;AAAEkE,IAAAA,IAAI,EAAEE;AAAR,GAAd,CAAb;AACA,SAAO,UAAA9C,QAAQ;AAAA,WACX1B,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,CAAuB,WAAWE,OAAX,GAAqB,QAA5C,EAAsDwB,IAAtD,CAA2DoB,IAA3D,EAAiEzC,IAAjE,CAAsE,UAACC,QAAD,EAAc;AAChFH,MAAAA,QAAQ,CAACL,QAAQ,CAAC;AAAEI,QAAAA,OAAO,EAAEA;AAAX,OAAD,CAAT,CAAR;AACH,KAFD,CADW;AAAA,GAAf;AAKH;AAED,OAAO,SAASgD,UAAT,CAAoBhD,OAApB,EAA6B0C,MAA7B,EAAqCK,SAArC,EAAgD;AAEnD,SAAO,UAAC9C,QAAD,EAAWY,QAAX,EAAwB;AAC3BtC,IAAAA,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCE,OAAhC,oBAAiD0C,MAAjD,GAA2DF,MAA3D,CAAkE;AAAEK,MAAAA,IAAI,EAAEE;AAAR,KAAlE,EAAuF5C,IAAvF,CAA4F,YAAM;AAC9FsB,MAAAA,OAAO,CAACC,GAAR,CAAY,CACRzB,QAAQ,CAAC;AACLO,QAAAA,IAAI,EAAEd,WADD;AAELgD,QAAAA,MAAM,EAANA,MAFK;AAGLK,QAAAA,SAAS,EAATA;AAHK,OAAD,CADA,CAAZ,EAMG5C,IANH,CAMQ;AAAA,eAAMF,QAAQ,CAACL,QAAQ,CAAC;AAAEI,UAAAA,OAAO,EAAEA;AAAX,SAAD,CAAT,CAAd;AAAA,OANR;AAOH,KARD,EAQGiD,KARH,CAQS,UAAAC,KAAK,EAAI;AACd,aAAO;AACHC,QAAAA,SAAS,EAAED,KAAK,CAACE,IADd;AAEHC,QAAAA,YAAY,EAAEH,KAAK,CAACvB;AAFjB,OAAP;AAIH,KAbD;AAcH,GAfD;AAgBH;AAED,OAAO,SAAS2B,UAAT,CAAoBtD,OAApB,EAA6B0C,MAA7B,EAAqC;AAExC,SAAO,UAAAzC,QAAQ;AAAA,WACX1B,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCE,OAAhC,oBAAiD0C,MAAjD,GAA2DtB,MAA3D,GAAoEjB,IAApE,CAAyE,YAAM;AAC3EsB,MAAAA,OAAO,CAACC,GAAR,CAAY,CACRzB,QAAQ,CAAC;AACLO,QAAAA,IAAI,EAAEb;AADD,OAAD,CADA,CAAZ,EAIGQ,IAJH,CAIQ;AAAA,eAAMF,QAAQ,CAACL,QAAQ,CAAC;AAAEI,UAAAA,OAAO,EAAEA;AAAX,SAAD,CAAT,CAAd;AAAA,OAJR;AAKH,KAND,EAMGiD,KANH,CAMS,UAAAC,KAAK,EAAI;AACd,aAAO;AACHC,QAAAA,SAAS,EAAED,KAAK,CAACE,IADd;AAEHC,QAAAA,YAAY,EAAEH,KAAK,CAACvB;AAFjB,OAAP;AAIH,KAXD,CADW;AAAA,GAAf;AAaH;AAED,OAAO,SAAS4B,QAAT,CAAkBC,KAAlB,EAAyB;AAC5B,SAAO,UAAAvD,QAAQ,EAAI;AACf,WAAOA,QAAQ,CAAC;AACZO,MAAAA,IAAI,EAAEf,SADM;AAEZgB,MAAAA,OAAO,EAAE+C;AAFG,KAAD,CAAf;AAIH,GALD;AAMH;AAED,OAAO,SAASC,mBAAT,CAA6BC,WAA7B,EAA0C;AAC7C,SAAO,UAACzD,QAAD,EAAWY,QAAX,EAAwB;AAAA,QACnBR,KADmB,GACTQ,QAAQ,GAAGC,aADF,CACnBT,KADmB;;AAE3B,QAAMsD,QAAQ,GAAGnF,CAAC,CAACoF,KAAF,CAAQvD,KAAK,CAACsD,QAAd,EAAwBD,WAAxB,CAAjB;;AACAnF,IAAAA,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCO,KAAK,CAACE,EAAtC,gBAAqDiC,MAArD,CAA4DmB,QAA5D,EAAsExD,IAAtE,CAA2E,UAAC0D,QAAD,EAAc;AACrFpC,MAAAA,OAAO,CAACC,GAAR,CAAY,CACRzB,QAAQ,CAAC;AACLO,QAAAA,IAAI,EAAErB,qBADD;AAELsB,QAAAA,OAAO,EAAEkD;AAFJ,OAAD,CADA,CAAZ,EAKGxD,IALH,CAKQ;AAAA,eAAMF,QAAQ,CAACL,QAAQ,CAAC;AAAEI,UAAAA,OAAO,EAAEK,KAAK,CAACE;AAAjB,SAAD,CAAT,CAAd;AAAA,OALR;AAMH,KAPD;AAQH,GAXD;AAYH;AAED,OAAO,SAASuD,WAAT,CAAqB9D,OAArB,EAA8B;AACjC,SAAO,UAACC,QAAD,EAAWY,QAAX,EAAwB;AAC3BtC,IAAAA,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCE,OAAhC,GAA2CoB,MAA3C,GAAoDjB,IAApD,CAAyD,YAAM;AAC3D7B,MAAAA,OAAO,CAACkD,IAAR,CAAa;AACTuC,QAAAA,QAAQ,EAAE;AADD,OAAb;AAGA,aAAO9D,QAAQ,CAAC;AACZO,QAAAA,IAAI,EAAExB;AADM,OAAD,CAAf;AAGH,KAPD;AAQH,GATD;AAUH;AAED,OAAO,SAASgF,SAAT,CAAmB3D,KAAnB,EAA0B;AAC7B,MAAM4D,QAAQ,GAAGzF,CAAC,CAACoF,KAAF,CAAQvD,KAAR,EAAe;AAC5BE,IAAAA,EAAE,EAAElC,SAAS,CAAC6F,YAAV,EADwB;AAE5BrB,IAAAA,IAAI,YAAKxC,KAAK,CAACwC,IAAX,cAFwB;AAG5BsB,IAAAA,GAAG,YAAK9D,KAAK,CAAC8D,GAAX;AAHyB,GAAf,CAAjB;;AAKA,SAAO,UAAAlE,QAAQ,EAAI;AACfA,IAAAA,QAAQ,CAACrB,aAAa,CAACqF,QAAd,CAAuBA,QAAvB,CAAD,CAAR;AACA,WAAO;AAAEzD,MAAAA,IAAI,EAAEvB;AAAR,KAAP;AACH,GAHD;AAIH;AAED,OAAO,SAASmF,WAAT,CAAqBpE,OAArB,EAA8BqE,UAA9B,EAA0C;AAC7C,SAAO,UAACpE,QAAD,EAAWY,QAAX,EAAwB;AAC3BtC,IAAAA,eAAe,CAACwB,EAAhB,CAAmBD,GAAnB,iBAAgCE,OAAhC,GAA2CwC,MAA3C,CAAkD;AAAEK,MAAAA,IAAI,EAAEwB;AAAR,KAAlD,EAAwElE,IAAxE,CAA6E,YAAM;AAC/EsB,MAAAA,OAAO,CAACC,GAAR,CAAY,CACRzB,QAAQ,CAAC;AACLO,QAAAA,IAAI,EAAEtB,YADD;AAELmF,QAAAA,UAAU,EAAVA;AAFK,OAAD,CADA,CAAZ,EAKGlE,IALH,CAKQ;AAAA,eAAMF,QAAQ,CAACL,QAAQ,CAAC;AAAEI,UAAAA,OAAO,EAAEA;AAAX,SAAD,CAAT,CAAd;AAAA,OALR;AAMH,KAPD,EAOGiD,KAPH,CAOS,UAAAC,KAAK,EAAI;AACd,aAAO;AACHC,QAAAA,SAAS,EAAED,KAAK,CAACE,IADd;AAEHC,QAAAA,YAAY,EAAEH,KAAK,CAACvB;AAFjB,OAAP;AAIH,KAZD;AAaH,GAdD;AAiBH","sourcesContent":["import FuseUtils from '@fuse/utils';\nimport history from '@history';\nimport firebaseService from 'app/services/firebaseService';\nimport _ from '@lodash';\nimport { showMessage } from 'app/store/actions/fuse';\nimport CardModel from '../../model/CardModel';\nimport ListModel from '../../model/ListModel';\nimport * as BoardsActions from './boards.actions';\nimport reorder from './reorder';\nimport { unset } from 'lodash';\n\n\nexport const GET_BOARD = '[SCRUMBOARD APP] GET BOARD';\nexport const DELETE_BOARD = '[SCRUMBOARD APP] DELETE BOARD';\nexport const COPY_BOARD = '[SCRUMBOARD APP] COPY BOARD';\nexport const RENAME_BOARD = '[SCRUMBOARD APP] RENAME BOARD';\nexport const CHANGE_BOARD_SETTINGS = '[SCRUMBOARD APP] CHANGE BOARD SETTINGS';\nexport const RESET_BOARD = '[SCRUMBOARD APP] RESET BOARD';\nexport const ORDER_LIST = '[SCRUMBOARD APP] ORDER LIST';\nexport const ORDER_CARD = '[SCRUMBOARD APP] ORDER CARD';\nexport const ADD_CARD = '[SCRUMBOARD APP] ADD CARD';\nexport const ADD_LIST = '[SCRUMBOARD APP] ADD LIST';\nexport const ADD_LABEL = '[SCRUMBOARD APP] ADD LABEL';\nexport const RENAME_LIST = '[SCRUMBOARD APP] RENAME LIST';\nexport const REMOVE_LIST = '[SCRUMBOARD APP] REMOVE LIST';\n\nexport function getBoard(params) {\n\n    let ref = firebaseService.db.ref('board/' + params.boardId);\n    return dispatch =>\n        ref\n            .once('value')\n            .then(snapshot => {\n\n                let board = snapshot.val();\n                if (board == null) return;\n                board.id = params.boardId;\n                return dispatch({\n                    type: GET_BOARD,\n                    payload: board\n                })\n\n            });\n\n}\n\nexport function resetBoard() {\n    return {\n        type: RESET_BOARD\n    };\n}\n\nexport function reorderList(result) {\n    return (dispatch, getState) => {\n        const { board } = getState().scrumboardApp;\n        const { lists } = board;\n        \n\n        let ordered = reorder(lists, result.source.index, result.destination.index);\n\n        firebaseService.db.ref(`board/${board.id}/lists`).remove().then(() => {\n            let promises = [];\n            ordered.forEach(element => {\n                unset(element.id);\n                promises.push( firebaseService.db.ref(`board/${board.id}/lists`).push(element) );\n            });\n\n            return Promise.all(promises).then(result => {\n                dispatch(\n                    showMessage({\n                        message: 'List Order Saved',\n                        autoHideDuration: 2000,\n                        anchorOrigin: {\n                            vertical: 'top',\n                            horizontal: 'right'\n                        }\n                    })\n                );\n            });\n        });\n        dispatch(getBoard({ boardId: board.id }));\n        return dispatch({\n\t\t\ttype: ORDER_LIST,\n\t\t\tpayload: ordered\n\t\t});\n    };\n}\n\nexport function reorderCard(result) {\n    return (dispatch, getState) => {\n        const { board } = getState().scrumboardApp;\n        \n        //const ordered = reorderQuoteMap(lists, result.source, result.destination);\n        board.lists.map(list => {\n            list.cards = _.keyBy(list.cards, 'id');\n            list.cards = _.toArray(list.cards);\n            return null\n        });\n        board.lists = _.toArray(board.lists);\n        board.lists = _.keyBy(board.lists, 'id');\n\n        console.log(lists);\n        firebaseService.db.ref(`board/${board.id}`).update(board).then(() => {\n            return dispatch(getBoard({ boardId: board.id }));\n        });\n\n    }\n}\nexport function newCard(boardId, listId, cardTitle) {\n    const data = new CardModel({ name: cardTitle });\n\n  \n    return dispatch =>\n        firebaseService.db.ref(`board/${boardId}/lists/${listId}/cards`).push(data).then((snapshot) => {\n            dispatch(getBoard({ boardId: boardId }));\n        });\n}\n\nexport function newList(boardId, listTitle) {\n    const data = new ListModel({ name: listTitle });\n    return dispatch =>\n        firebaseService.db.ref('board/' + boardId + '/lists').push(data).then((snapshot) => {\n            dispatch(getBoard({ boardId: boardId }));\n        });\n\n}\n\nexport function renameList(boardId, listId, listTitle) {\n\n    return (dispatch, getState) => {\n        firebaseService.db.ref(`board/${boardId}/lists/${listId}`).update({ name: listTitle }).then(() => {\n            Promise.all([\n                dispatch({\n                    type: RENAME_LIST,\n                    listId,\n                    listTitle\n                })\n            ]).then(() => dispatch(getBoard({ boardId: boardId })));\n        }).catch(error => {\n            return {\n                errorCode: error.code,\n                errorMessage: error.message\n            }\n        });\n    };\n}\n\nexport function removeList(boardId, listId) {\n\n    return dispatch =>\n        firebaseService.db.ref(`board/${boardId}/lists/${listId}`).remove().then(() => {\n            Promise.all([\n                dispatch({\n                    type: REMOVE_LIST\n                })\n            ]).then(() => dispatch(getBoard({ boardId: boardId })));\n        }).catch(error => {\n            return {\n                errorCode: error.code,\n                errorMessage: error.message\n            }\n        });\n}\n\nexport function addLabel(label) {\n    return dispatch => {\n        return dispatch({\n            type: ADD_LABEL,\n            payload: label\n        });\n    };\n}\n\nexport function changeBoardSettings(newSettings) {\n    return (dispatch, getState) => {\n        const { board } = getState().scrumboardApp;\n        const settings = _.merge(board.settings, newSettings);\n        firebaseService.db.ref(`board/${board.id}/settings`).update(settings).then((response) => {\n            Promise.all([\n                dispatch({\n                    type: CHANGE_BOARD_SETTINGS,\n                    payload: settings\n                })\n            ]).then(() => dispatch(getBoard({ boardId: board.id })));\n        })\n    };\n}\n\nexport function deleteBoard(boardId) {\n    return (dispatch, getState) => {\n        firebaseService.db.ref(`board/${boardId}`).remove().then(() => {\n            history.push({\n                pathname: '/scrumboard/boards'\n            });\n            return dispatch({\n                type: DELETE_BOARD\n            });\n        });\n    };\n}\n\nexport function copyBoard(board) {\n    const newBoard = _.merge(board, {\n        id: FuseUtils.generateGUID(),\n        name: `${board.name} (Copied)`,\n        uri: `${board.uri}-copied`\n    });\n    return dispatch => {\n        dispatch(BoardsActions.newBoard(newBoard));\n        return { type: COPY_BOARD };\n    };\n}\n\nexport function renameBoard(boardId, boardTitle) {\n    return (dispatch, getState) => {\n        firebaseService.db.ref(`board/${boardId}`).update({ name: boardTitle }).then(() => {\n            Promise.all([\n                dispatch({\n                    type: RENAME_BOARD,\n                    boardTitle\n                })\n            ]).then(() => dispatch(getBoard({ boardId: boardId })));\n        }).catch(error => {\n            return {\n                errorCode: error.code,\n                errorMessage: error.message\n            }\n        });\n    };\n\n\n}"]},"metadata":{},"sourceType":"module"}